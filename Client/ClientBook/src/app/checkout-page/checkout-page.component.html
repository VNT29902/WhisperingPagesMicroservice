<app-header></app-header>

<section class="section-wrapper">
  <div class="section-container grid-3">
    <!-- grid-3 thay cho checkout-3col -->

    <!-- C·ªôt 1: Th√¥ng tin nh·∫≠n h√†ng -->
    <section class="col">
      <h2>Th√¥ng tin nh·∫≠n h√†ng</h2>

      <form class="form info-form" [formGroup]="form">
        <!-- S·ªï ƒë·ªãa ch·ªâ -->
        <div class="row">
          <label>S·ªï ƒë·ªãa ch·ªâ</label>
          <div class="saved-address">
            <ng-container *ngIf="displayAddress; else noAddr">
              <p class="address-text">{{ displayAddress }} (M·∫∑c ƒë·ªãnh)</p>
            </ng-container>
            <ng-template #noAddr>
              <p class="address-text empty">Ch∆∞a c√≥ ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh</p>
            </ng-template>
          </div>
        </div>

        <div class="row">
          <label>Email</label>
          <input type="email" formControlName="email" readonly />
        </div>

        <div class="row">
          <label>H·ªç v√† t√™n</label>
          <input type="text" formControlName="fullName" />
        </div>

        <div class="row">
          <label>S·ªë ƒëi·ªán tho·∫°i (t√πy ch·ªçn)</label>
          <div class="input with-flag">
            <input type="text" formControlName="phone" />
            <span class="flag">üáªüá≥</span>
          </div>
        </div>

        <div class="row">
          <label>ƒê·ªãa ch·ªâ (t√πy ch·ªçn)</label>
          <input
            type="text"
            formControlName="street"
            placeholder="S·ªë nh√† / ƒë∆∞·ªùng"
          />
        </div>

        <div class="grid-2">
          <div class="row">
            <label>T·ªânh/Th√†nh</label>
            <select formControlName="province">
              <option value="" disabled *ngIf="!form.get('province')?.value">
                -- Ch·ªçn t·ªânh/th√†nh --
              </option>
              <option *ngFor="let p of provinces" [value]="p.full_name">
                {{ p.full_name }}
              </option>
            </select>
            <small class="hint" *ngIf="!provincesLoaded"
              >ƒêang t·∫£i t·ªânh/th√†nh‚Ä¶</small
            >
          </div>

          <div class="row">
            <label>Ph∆∞·ªùng/X√£</label>
            <select formControlName="ward" [disabled]="!provinces.length">
              <option value="" disabled *ngIf="!form.get('ward')?.value">
                -- Ch·ªçn ph∆∞·ªùng/x√£ --
              </option>
              <option *ngFor="let w of wards" [value]="w.full_name">
                {{ w.full_name }}
              </option>
            </select>

            <small
              class="hint"
              *ngIf="form.get('province')?.value && !wardsLoaded"
            >
              ƒêang t·∫£i ph∆∞·ªùng/x√£‚Ä¶
            </small>
          </div>
        </div>

        <div class="row">
          <label>Ghi ch√∫ (t√πy ch·ªçn)</label>
          <textarea rows="3" formControlName="note"></textarea>
        </div>
      </form>
    </section>

    <!-- C·ªôt 2: V·∫≠n chuy·ªÉn + Thanh to√°n -->
    <section class="col">
      <h2>V·∫≠n chuy·ªÉn</h2>
      <div class="radio-card">
        <label class="radio">
          <input type="radio" checked />
          <span>Giao h√†ng t·∫≠n n∆°i</span>
          <strong class="price">40.000ƒë</strong>
        </label>
      </div>

      <h2>Thanh to√°n</h2>
      <div class="radio-card">
        <label class="radio">
          <input type="radio" />
          <span>Thanh to√°n khi giao h√†ng (COD)</span>
          <span class="icon-money">üíµ</span>
        </label>
      </div>
    </section>

    <!-- C·ªôt 3: ƒê∆°n h√†ng -->
    <aside class="col">
      <h2>ƒê∆°n h√†ng ({{ cart?.items?.length || 0 }} s·∫£n ph·∫©m)</h2>

      <ng-container *ngIf="cart?.items?.length; else emptyCart">
        <div class="cart-item" *ngFor="let it of cart!.items">
          <img [src]="it.image" (error)="onImgError($event)" alt="" />
          <div class="meta">
            <p class="title">{{ it.title }}</p>
            <p class="qty">SL: {{ it.quantity }}</p>
          </div>
          <div class="line-price">{{ it.price * it.quantity | number }}ƒë</div>
        </div>

        <div class="summary">
          <div class="row">
            <span>T·∫°m t√≠nh</span><strong>{{ subtotal | number }}ƒë</strong>
          </div>
          <div class="row">
            <span>Ph√≠ v·∫≠n chuy·ªÉn</span
            ><strong>{{ shippingFee | number }}ƒë</strong>
          </div>
          <div class="row total">
            <span>T·ªïng c·ªông</span><strong>{{ total | number }}ƒë</strong>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn back-cart" routerLink="/cart">
            ‚¨Ö Quay l·∫°i gi·ªè h√†ng
          </button>
          <button
            type="button"
            class="btn place-order"
            (click)="placeOrder()"
            [disabled]="!form.valid || !cart?.items?.length"
          >
            ‚úÖ ƒê·∫∑t h√†ng
          </button>
        </div>
      </ng-container>

      <ng-template #emptyCart>
        <p>Gi·ªè h√†ng tr·ªëng.</p>
      </ng-template>
    </aside>
  </div>
</section>

<app-footer></app-footer>
